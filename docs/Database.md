# Database

## General notes

- Language: Postgres
- Provider: Supabase
- Naming conventions: snake_case, singular

## Integration

- Website queries `icon` table by:
  - `version` to only include icons associated with the currently deployed version
  - an `ilike` query on `name` to search for icons by name
- For each `icon`, the website queries the `provider` table to get the provider details
- For each `provider`, the website queries the `license` table and then the `license_type` table to get the license details for the provider

## Table Schemas

[Supabase Studio](https://supabase.com/dashboard/project/ojglkplkgnfcbmejsxvb/database/schemas)

![Database Schema](https://i.imgur.com/Nj7azeG.png)

### icon

```sql
CREATE TABLE "public"."icon" (
    "id" bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL, -- Unique identifier for the icon
    "created_at" timestamp with time zone NOT NULL, -- Timestamp when the icon was created
    "version" text NOT NULL, -- Git tag or commit hash when icon was scraped
    "name" text NOT NULL, -- Icon filename without extension
    "svg" text NOT NULL, -- Cleaned SVG markup content
    "source_url" text NOT NULL, -- Direct GitHub URL to the original icon file
    "provider_id" bigint NOT NULL -- Foreign key reference to provider table
);
```

### provider

```sql
CREATE TABLE "public"."provider" (
    "id" bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL, -- Unique identifier for the provider
    "created_at" timestamp with time zone NOT NULL DEFAULT now(), -- Timestamp when the provider was created
    "name" text NOT NULL, -- Human-readable provider name (e.g., 'Hero Icons', 'Lucide')
    "git_url" text NOT NULL, -- Repository URL for the icon provider (e.g., 'https://github.com/heroicons/heroicons.git')
    "git_branch" text NOT NULL, -- Default branch to scrape from
    "git_icons_dir" text NOT NULL -- Directory path within repo containing icon files
);
```

### TODO: license

```sql
CREATE TABLE "public"."license" (
    "id" uuid NOT NULL, -- Unique identifier for the license
    "provider_id" varchar NOT NULL, -- Foreign key reference to provider table
    "license_type_id" varchar NOT NULL, -- Foreign key reference to license_type table
    "url" varchar NOT NULL -- URL to the full license text for this specific provider
);
```

### TODO: license_type

```sql
CREATE TABLE "public"."license_type" (
    "id" varchar NOT NULL, -- Unique identifier for the license type (e.g., 'mit', 'cc_by_4', 'apache_2')
    "name" varchar NOT NULL, -- License name (e.g., 'MIT License', 'Creative Commons Attribution 4.0')
    "type" varchar NOT NULL, -- License category (e.g., 'MIT', 'CC BY', 'Apache', 'ISC', 'CC0')
    "user_obligations" text NOT NULL, -- What users must do when using icons with this license type
    "website_obligations" text NOT NULL -- What the website must do regarding this license type
);
```
